<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>Manifest Format - Tako</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../css/highlight.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Manifest Format";
    var mkdocs_page_input_path = "manifest-format.md";
    var mkdocs_page_url = "/manifest-format/";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js"></script>
  <script src="../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../js/highlight.pack.js"></script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> Tako</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="..">Overview</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">User Guide</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../downloading-images/">Downloading Images</a>
                </li>
                <li class="">
                    
    <a class="" href="../distributing-images/">Distributing Images</a>
                </li>
                <li class="">
                    
    <a class="" href="../configuration/">Configuration</a>
                </li>
                <li class="">
                    
    <a class="" href="../versions/">Versions</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Reference</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../tako-fetch/">tako fetch</a>
                </li>
                <li class="">
                    
    <a class="" href="../tako-store/">tako store</a>
                </li>
                <li class="">
                    
    <a class="" href="../tako-gen-key/">tako gen-key</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Internals</span>
    <ul class="subnav">
                <li class=" current">
                    
    <a class="current" href="./">Manifest Format</a>
    <ul class="subnav">
            
    <li class="toctree-l3"><a href="#manifest-format">Manifest Format</a></li>
    
        <ul>
        
            <li><a class="toctree-l4" href="#structure">Structure</a></li>
        
            <li><a class="toctree-l4" href="#example">Example</a></li>
        
            <li><a class="toctree-l4" href="#rationale">Rationale</a></li>
        
        </ul>
    

    </ul>
                </li>
    </ul>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">Tako</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
        
          <li>Internals &raquo;</li>
        
      
    
    <li>Manifest Format</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/ruuda/tako/edit/master/docs/manifest-format.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="manifest-format">Manifest Format</h1>
<p>The manifest lists all available image versions and their SHA256 hashes.
The format is human-readable for convenience.</p>
<h2 id="structure">Structure</h2>
<p>The manifest starts with a line <code>Tako Manifest 1</code> that identifies the file as
a manifest.</p>
<p>After the header is a blank line. Then follows one image version per line,
formatted as the version number, a space, the file size in bytes, a space, and
the hexadecimally encoded SHA256 of the image. This makes it easy to use
<code>sha256sum</code> as a sanity check. Versions are sorted by version number.</p>
<p>After the image versions is again a blank line, followed by the base64-encoded
Ed25519 signature of all of the preceding content (including newlines).</p>
<p>Newlines are a single line feed (<code>\n</code>). Version numbers should be ascii. Hence
the entire file is valid ascii, and also valid UTF-8.</p>
<h2 id="example">Example</h2>
<pre><code>Tako Manifest 1

1.0.0 10092569 b101acf3c4870594bb4363090d5ab966c193fb329e2f2db2096708e08c4913e2
1.1.0 11239411 9641a49d02e90cbb6213f202fb632da70cdc59073d42283cfcdc1d786454f17f
2.0.0 11862029 b7b01c6f6772529c66b945e559cb1f46546ef62063e44c1d1068725157ae1cda

fQK92C/tPnH0uqxrTEnU+LEE4jnSpQPbOItph4kGAEfWEmn6wPXiQsSdXlDmoneaJkG6KLvInTvB7FlELoeQFg==
</code></pre>
<h2 id="rationale">Rationale</h2>
<p>The manifest format is inspired by the well-established practice of distributing
a GPG-signed <code>SHASUMS</code> file.</p>
<ul>
<li>We include a version line, so future versions of Tako can still read older
  manifests.</li>
<li>The signature is embedded, rather than external, to avoid race conditions when
  uploading a new manifest to the server. One would still need to upload new
  images before uploading a new manifest.</li>
<li>The signature is an Ed25519 signature rather than a GPG signature, because GPG
  involves a stateful trust store that is difficult to provision in an automated
  way. In practice people use GPG is only for signature verification. For
  authentication, rather than relying on GPGâ€™s web of trust, people announce
  the fingerprint of their key in a trusted location (Twitter, Github, an https-
  protected website). Ed25519 public keys are small enough that the full public
  key can be announced in places where we would normally announce a fingerprint.</li>
<li>The manifest does not include timestamps, to ensure that it is reproducible.
  Timestamps belong in a changelog or audit log.</li>
<li>Entries should never be removed from the manifest. There are reasons to stop
  providing an image (for instance because it contained a critical bug that
  causes data loss). In that case the image itself can be removed from the
  server, but it should still be listed in the manifest. This prevents
  accidentally releasing different images under the same version number. It also
  ensures that clients which did download the image can still identify it, so
  they do not end up running a mysterous image without record of existence.</li>
<li>The size of each image is included (and therefore signed) so malicious mirrors
  cannot cause clients to download large files that would fill up their disks.</li>
</ul>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="../tako-gen-key/" class="btn btn-neutral" title="tako gen-key"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/ruuda/tako/" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../tako-gen-key/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js"></script>
      <script src="../search/require.js"></script>
      <script src="../search/search.js"></script>

</body>
</html>
