
<!DOCTYPE html>
<html>
<head>
  <!--
    Kilsbergen MkDocs theme copyright 2019 Ruud van Asseldonk.
    Licensed under the Apache 2.0 license.
    See https://github.com/ruuda/kilsbergen.
  -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Manifest Format — Tako</title>
  <link href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,500" rel="stylesheet">
  <style>
  /* The Inter font family, see https://rsms.me/inter.
     https://rsms.me/inter/#faq-cdn suggests that linking these files directly is fine.
  */
  @font-face {
    font-family: Inter;
    font-style:  normal;
    font-weight: 400;
    src: url("https://rsms.me/inter/font-files/Inter-Regular.woff2?v=3.11") format("woff2"),
         url("https://rsms.me/inter/font-files/Inter-Regular.woff?v=3.11") format("woff");
  }
  @font-face {
    font-family: Inter;
    font-style:  italic;
    font-weight: 400;
    src: url("https://rsms.me/inter/font-files/Inter-Italic.woff2?v=3.11") format("woff2"),
         url("https://rsms.me/inter/font-files/Inter-Italic.woff?v=3.11") format("woff");
  }
  @font-face {
    font-family: Inter;
    font-style:  normal;
    font-weight: 500;
    src: url("https://rsms.me/inter/font-files/Inter-Medium.woff2?v=3.11") format("woff2"),
         url("https://rsms.me/inter/font-files/Inter-Medium.woff?v=3.11") format("woff");
  }
  @font-face {
    font-family: Inter;
    font-style:  normal;
    font-weight: 600;
    src: url("https://rsms.me/inter/font-files/Inter-SemiBold.woff2?v=3.11") format("woff2"),
         url("https://rsms.me/inter/font-files/Inter-SemiBold.woff?v=3.11") format("woff");
  }
  @font-face {
    font-family: Inter;
    font-style:  normal;
    font-weight: 700;
    src: url("https://rsms.me/inter/font-files/Inter-Bold.woff2?v=3.11") format("woff2"),
         url("https://rsms.me/inter/font-files/Inter-Bold.woff?v=3.11") format("woff");
  }
  /* Modular scale with exponent 1.7^(1/3). The 1.7 was chosen as the line hight
     that goes well with Inter. Previously I used 1.59, but it was just too tight.
     0.59em
     0.70em
     1.00em
     1.19em
     1.42em
     1.70em
     2.02em
     2.42em
  */
  * { margin: 0; padding: 0; border-spacing: 0; }
  html {
    font-family: Inter, Roboto, sans-serif;
    /*
    Turn on character variant 8 for Inter, which puts serifs on the uppercase I.
    Also turn on variant 1, which has a curved 1.
    Disable contextual alternates for now. There is a bug, either in Inter or
    in Chrome (https://crbug.com/1046095) that causes colons after a <strong> to
    be raised above the baseline.
    */
    font-feature-settings: 'cv01' 1, 'cv08' 1, 'calt' 0;

    font-size: 16px;
    line-height: 1.7em;
    background-color: #fff;
    height: 100%;
  }
  body {
    height: 100%;
  }
  #content {
    display: grid;
    grid-template-columns: auto 16rem 50rem auto;
    color: #333;
    min-height: 100%;
  }
  #main {
    grid-area: 1 / 3 / 2 / 4;
    padding: 2.2rem;
    padding-left: 4rem;
    padding-right: 4rem;
    overflow: hidden;
  }
  #breadcrumbs {
    margin-bottom: 3rem;
    word-spacing: 0.3em;
    color: #78a;
  }
  #breadcrumbs a {
    word-spacing: 0;
    color: #78a;
  }
  article {
    margin-top: 1.3rem;
  }
  h1, h2, h3 {
    font-weight: 600;
    font-size: 1rem;
    color: #444;
  }
  h1 {
    font-size: 2rem;
    margin-bottom: 2.1rem;
  }
  h2 {
    font-size: 1.42rem;
    margin-top: 3.5rem;
    margin-bottom: 1.6rem;
  }
  code {
    font-family: 'Roboto Mono', monospace;
    font-size: 0.84rem;
    line-height: 1.5rem;
  }
  h3 > code {
    /* Roboto Mono 500 is about as heavy as Inter semibold (600). */
    font-weight: 500;
  }
  abbr {
    text-transform: uppercase;
    /* Downsize so caps are x-height, and compensate weight loss. */
    font-size: 0.78rem;
    font-weight: 500;
    letter-spacing: 0.05rem;
    /* Prevent abbrs from changing the line height of lines in which they occur. */
    line-height: 0;
  }
  sub, sup {
    /* Don't disturb the line height of normal text. */
    line-height: 0rem;
    font-size: 0.78rem;
    font-weight: 500;
  }
  p > code,
  a > code,
  h3 > code,
  li > code,
  td > code {
    background-color: #f0f0f0;
    padding: 0.13rem;
    padding-left: 0.3rem;
    padding-right: 0.3rem;
    border-radius: 0.2rem;
    line-height: 1rem;
  }
  h3 {
    padding-top: 0.9rem;
    padding-bottom: 0.8rem;
  }
  h3 > code {
    margin-left: -0.1rem;
  }
  a {
    color: #36d;
    text-decoration: none;
  }
  p, ul, ol, pre, table {
    /* Same space as line height, leave exactly one line blank. */
    margin-bottom: 1.7rem;
  }
  pre {
    padding-top: 0.8rem;
    padding-bottom: 0.9rem;
    padding-left: 1.19rem;
    padding-right: 0;
    background-color: #f8f8f8;
    border-radius: 0 0.2rem 0.2rem 0;
    border-left: 0.3rem solid #d5d8e0;
    overflow-x: auto;
  }
  pre > code {
    margin-right: 1.41rem;
    color: #555;
  }
  ul, ol {
    list-style-type: none;
    counter-reset: item;
  }
  table {
    font-variant-numeric: tabular-nums;
  }
  th, td {
    padding-right: 2rem;
  }
  th {
    text-align: left;
  }
  td > img {
    display: block;
    padding-top: 1em;
    padding-bottom: 1em;
  }
  #main ul li:before {
    color: #555;
    content: '\2022';
    display: inline-block;
    font-weight: 700;
    margin-left: -0.9rem;
    width: 0.9rem;
  }
  #main ul li {
    margin-left: 0.87rem;
  }
  #main ol li:before {
    content: counter(item);
    display: inline-block;
    font-weight: 700;
    width: 0.8rem;
    margin-left: -1.6rem;
    padding-right: 0.8rem;
  }
  #main ol li {
    margin-left: 1.6rem;
    counter-increment: item;
  }
  #nav-prev-next {
    margin-top: 3.4rem;
    padding-bottom: 3.3rem;
  }
  #nav-prev, #nav-next, #repo-link {
    display: inline-block;
  }
  #nav-prev {
    float: left;
  }
  #nav-next, #repo-link {
    float: right;
    text-align: right;
  }
  #nav-prev::before {
    content: '\219e';
    padding-right: 0.5em;
  }
  #nav-next::after {
    content: '\21a0';
    padding-left: 0.5em;
  }
  aside {
    grid-area: 1 / 1 / 2 / 3;
    border-right: 1px solid #eee;
    background-color: #fafafa;
  }
  aside nav {
    margin-top: 9rem;
    padding-bottom: 3.4rem;
    width: 14rem;
    float: right;
    /* Put the active chapter border over the sidebar border. */
    margin-right: -1px;
  }
  aside a {
    color: #78a;
  }
  aside .toc-section {
    font-weight: 700;
  }
  aside ul {
    margin-bottom: 0;
  }
  aside li ul {
    padding-top: 0.6rem;
    padding-bottom: 1.1rem;
  }
  aside li.toc-section {
    padding-top: 1.7rem;
  }
  aside li.toc-section a {
    color: #36d;
  }
  aside li.current, aside li ul {
    border-right: 0.3em solid #d5d8e0;
    padding-left: 1em;
    margin-left: -1em;
  }
  aside .current a {
    font-weight: 600;
  }
  aside li.toc-heading {
    padding-left: 1em;
  }

  @media(max-width: 63rem)
  {
    #content {
      /* Manual implementation of max-width: on narrower viewports,
         auto-size the body. */
      grid-template-columns: 0 16rem auto 0;
    }
  }

  @media(max-width: 1150px)
  {
    html { font-size: 15px; }
  }

  /* Move the sidebar TOC below content at small widths. */
  @media(max-width: 800px)
  {
    #content {
      display: block;
    }
    aside {
      border-top: 1px solid #eee;
      border-right: 0px none;
    }
    aside nav {
      margin-left: 4em;
      margin-top: 1.7em;
      float: none;
    }
    #main {
      padding-bottom: 1.7em;
    }
    aside li.current, aside li ul {
      border-right: 0px none;
    }
  }

  /* Use less generous margins for very narrow viewports. */
  @media(max-width: 650px)
  {
    #main {
      padding-left: 2rem;
      padding-right: 2rem;
    }
    aside nav {
      margin-left: 2rem;
      padding-bottom: 2rem;
    }
  }

  @media(max-width: 450px)
  {
    #main {
      padding-left: 1.7em;
      padding-right: 1.7em;
    }
    aside nav {
      margin-left: 1.7em;
    }
  }
  </style>
</head>
<body>
  <div id="content">
    <div id="main">
      <nav id="breadcrumbs">
        <a href="..">Tako</a>
        › <a href="..">Internals</a>
  › <a href="./">Manifest Format</a>
  <a id="repo-link" href="https://github.com/ruuda/tako/">GitHub</a>
      </nav>
      <article>
        <h1 id="manifest-format">Manifest Format</h1>
<p>The manifest lists all available image versions and their SHA256 hashes.
The format is human-readable for convenience.</p>
<h2 id="structure">Structure</h2>
<p>The manifest starts with a line <code>Tako Manifest 1</code> that identifies the file as
a manifest.</p>
<p>After the header is a blank line. Then follows one image version per line,
formatted as the version number, a space, the file size in bytes, a space, and
the hexadecimally encoded SHA256 of the image. This makes it easy to use
<code>sha256sum</code> as a sanity check. Versions are sorted by version number.</p>
<p>After the image versions is again a blank line, followed by the base64-encoded
Ed25519 signature of all of the preceding content (including newlines).</p>
<p>Newlines are a single line feed (U+000A). Version numbers should be
<abbr>ASCII</abbr>. Hence the entire file is valid <abbr>ASCII</abbr>, and also
valid <abbr>UTF-8</abbr>.</p>
<h2 id="example">Example</h2>
<pre><code>Tako Manifest 1

1.0.0 10092569 b101acf3c4870594bb4363090d5ab966c193fb329e2f2db2096708e08c4913e2
1.1.0 11239411 9641a49d02e90cbb6213f202fb632da70cdc59073d42283cfcdc1d786454f17f
2.0.0 11862029 b7b01c6f6772529c66b945e559cb1f46546ef62063e44c1d1068725157ae1cda

fQK92C/tPnH0uqxrTEnU+LEE4jnSpQPbOItph4kGAEfWEmn6wPXiQsSdXlDmoneaJkG6KLvInTvB7FlELoeQFg==
</code></pre>
<h2 id="rationale">Rationale</h2>
<p>The manifest format is inspired by the well-established practice of distributing
a <abbr>GPG</abbr>-signed <code>SHASUMS</code> file.</p>
<ul>
<li>We include a version line, so future versions of Tako can still read older
  manifests.</li>
<li>The signature is embedded, rather than external, to avoid race conditions when
  uploading a new manifest to the server. One would still need to upload new
  images before uploading a new manifest.</li>
<li>The signature is an Ed25519 signature rather than a <abbr>GPG</abbr> signature,
  because <abbr>GPG</abbr> involves a stateful trust store that is difficult to
  provision in an automated way. In practice people use <abbr>GPG</abbr> only
  for signature verification. For authentication, rather than relying on
  <abbr>GPG</abbr>’s web of trust, people announce the fingerprint of their key
  in a trusted location (Twitter, Github, an https-protected website). Ed25519
  public keys are small enough that the full public key can be announced in
  places where we would normally announce a fingerprint.</li>
<li>The manifest does not include timestamps, to ensure that it is reproducible.
  Timestamps belong in a changelog or audit log.</li>
<li>Entries should never be removed from the manifest. There are reasons to stop
  providing an image (for instance because it contained a critical bug that
  causes data loss). In that case the image itself can be removed from the
  server, but it should still be listed in the manifest. This prevents
  accidentally releasing different images under the same version number. It also
  ensures that clients which did download the image can still identify it, so
  they do not end up running a mysterous image without record of existence.</li>
<li>The size of each image is included (and therefore signed) so malicious mirrors
  cannot cause clients to download large files that would fill up their disks.</li>
</ul>
      </article>
      <nav id="nav-prev-next">
        <a id="nav-prev" href="../tako-gen-key/" title="tako gen-key">Previous</a>
        </nav>
      </div>
    <aside>
      <nav>
        <ul>
        <li class="toc-section"><a href="..">Overview</a></li>
          <li class="toc-section"><a href="../downloading-images/">User Guide</a></li>
          <li class="toc-chapter
              "><a href="../downloading-images/">Downloading Images</a></li>
            <li class="toc-chapter
              "><a href="../distributing-images/">Distributing Images</a></li>
            <li class="toc-chapter
              "><a href="../configuration/">Configuration</a></li>
            <li class="toc-chapter
              "><a href="../versions/">Versions</a></li>
            <li class="toc-section"><a href="../tako-fetch/">Reference</a></li>
          <li class="toc-chapter
              "><a href="../tako-fetch/">tako fetch</a></li>
            <li class="toc-chapter
              "><a href="../tako-store/">tako store</a></li>
            <li class="toc-chapter
              "><a href="../tako-gen-key/">tako gen-key</a></li>
            <li class="toc-section"><a href="./">Internals</a></li>
          <li class="toc-chapter
               current"><a href="./">Manifest Format</a></li>
            <li><ul>
                <li class="toc-heading"><a href="#structure">Structure</a></li>
                <li class="toc-heading"><a href="#example">Example</a></li>
                <li class="toc-heading"><a href="#rationale">Rationale</a></li>
                </ul></li>
               </ul>
      </nav>
    </aside>
  </div>
</body>
</html>